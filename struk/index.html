<!doctype html><html lang="id"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Rumah Nenek Laundry</title><style>:root{font-family:Arial,sans-serif;color:#111}body{margin:0;padding:12px;background:#f7f7f7}.card{max-width:720px;margin:auto;background:#fff;padding:16px;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,0.05)}h2{text-align:center;font-size:18px;margin-bottom:10px}label{font-size:13px;display:block;margin-top:10px;font-weight:600}input,textarea{width:100%;padding:8px;font-size:14px;box-sizing:border-box;border:1px solid #ddd;border-radius:6px;margin-top:4px}button{background:#00796b;color:#fff;border:none;padding:10px;border-radius:6px;font-size:14px;cursor:pointer}button.secondary{background:#666}button.danger{background:#d32f2f}.row{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap}.muted{font-size:12px;color:#555;margin-top:6px}.offline{background:#ffeb3b;color:#000;padding:8px;border-radius:6px;margin-top:6px;font-size:13px}.thermal{width:280px;font-family:monospace;white-space:pre-wrap;background:#fff;border:1px dashed #000;padding:8px;border-radius:4px;margin:10px auto}.search-section{margin-top:20px;border-top:1px solid #eee;padding-top:12px}.results{margin-top:10px}.result-card{border:1px solid #ddd;border-radius:6px;padding:8px;margin-bottom:8px;background:#fafafa;font-size:13px}.actions button{margin-right:6px;margin-top:6px}@media print{body *{visibility:hidden}.thermal,.thermal *{visibility:visible}.thermal{position:absolute;left:0;top:0;width:100%}}</style></head><body><div class="card"><h2>ðŸ§º Rumah Nenek Laundry</h2><div id="pinScreen"><label>Masukkan PIN</label><input id="pinInput" type="text" placeholder="PIN" autocomplete="off"/><button id="pinBtn">Masuk</button><div id="pinMsg" class="muted"></div></div><div id="mainScreen" style="display:none"><label>No Urut</label><input id="noUrut" type="text" readonly/><label>No Kwitansi</label><input id="noKwitansi" type="text" readonly/><label>Nama Konsumen</label><input id="nama" type="text" placeholder="Nama pelanggan"/><label>Alamat Konsumen</label><input id="alamat" type="text" placeholder="Alamat (opsional)"/><label>No WA</label><input id="nowa" type="tel" placeholder="08xxxxxxxxxx"/><label>Keterangan / Layanan</label><textarea id="catatan" rows="2" placeholder="Misal: Cuci Kering, Setrika, Kilat"></textarea><label>Total Harga (Rp)</label><input id="total" type="number" placeholder="0"/><div class="row"><button id="saveBtn">Simpan</button><button id="resetBtn" class="secondary">Reset</button></div><div class="muted" id="saveMsg"></div><div id="offlineMsg" class="offline" style="display:none"></div><div id="previewArea" style="display:none"><div class="thermal" id="previewBox"></div><div class="row"><button id="waBtn">Bagikan WA</button><button id="copyBtn" class="secondary">Copy</button></div></div><div class="search-section"><label>Cari Struk</label><input id="searchInput" type="text" placeholder="Cari No, Nama, No Struk, No WA"/><div class="row"><button id="searchBtn">Cari</button><button id="exportBtn" class="secondary">Ekspor CSV</button></div><div id="searchMsg" class="muted"></div><div class="results" id="results"></div></div></div></div><script>
(()=>{const A="https://script.google.com/macros/s/AKfycbws8eecOfsfXfPPT_hq7BFhKNgpG2suDQLdita-D_7V4WBxMarLKj_XSpUnnQdPpEUOVA/exec",b=id=>document.getElementById(id),c=b("pinScreen"),d=b("pinInput"),e=b("pinBtn"),f=b("pinMsg"),g=b("mainScreen"),h=b("noUrut"),i=b("noKwitansi"),j=b("nama"),k=b("alamat"),l=b("nowa"),m=b("catatan"),n=b("total"),o=b("saveBtn"),p=b("resetBtn"),q=b("saveMsg"),r=b("offlineMsg"),s=b("previewArea"),t=b("previewBox"),u=b("waBtn"),v=b("copyBtn"),w=b("searchInput"),x=b("searchBtn"),y=b("exportBtn"),z=b("results"),A1=b("searchMsg");function B(a){return Number(a||0).toLocaleString("id-ID")}function C(a){let b=String(a||"").replace(/\s+/g,"").replace(/[^0-9+]/g,"");return b.startsWith("0")?b="62"+b.slice(1):b.startsWith("62")||(b="62"+b),b}function D(a){return["   RUMAH NENEK LAUNDRY","Jl. Mashudi No 10 - Cariu","WA/DANA 0895-6223-09251 a.n. Tita Juarsih","----------------------------------","No Struk   : "+a.noKwitansi,"No Urut    : "+a.noUrut,a.alamat?"Alamat     : "+a.alamat:"",a.nowa?"WA         : "+a.nowa:"",a.catatan?"Keterangan : "+a.catatan:"","----------------------------------","Total      : Rp "+B(a.total),"----------------------------------"].filter(Boolean).join("\n")}async function E(){try{await fetch(A+"?ping=1",{method:"GET",cache:"no-store"});return!0}catch{ return!1}}async function F(){const a=JSON.parse(localStorage.getItem("pendingData")||"[]");if(a.length===0)return;for(const b of a)try{await fetch(A+"?action=saveData&"+new URLSearchParams(b))}catch(c){return}localStorage.removeItem("pendingData");r.style.display="none"}e.onclick=async()=>{f.textContent="Memeriksa PIN...";const a=await fetch(A+"?action=checkPIN&pin="+encodeURIComponent(d.value)).then(a=>a.text());a.trim()==="OK"?(c.style.display="none",g.style.display="block",await fetch(A+"?action=getLast").then(a=>a.json()).then(a=>{h.value=a.noUrut;i.value=a.noKwitansi}),F()):f.textContent="PIN salah. Coba lagi."};o.onclick=async()=>{if(!confirm("Simpan data transaksi ini?"))return;const a={noUrut:h.value,nama:j.value,alamat:k.value,nowa:l.value,catatan:m.value,total:n.value,noKwitansi:i.value};if(!a.nama||!a.total){q.textContent="Nama dan total wajib diisi.";return}t.textContent=D(a);s.style.display="block";q.textContent="Menyimpan...";const b=await E();if(!b){const c=JSON.parse(localStorage.getItem("pendingData")||"[]");c.push(a);localStorage.setItem("pendingData",JSON.stringify(c));r.style.display="block";r.textContent="ðŸ“¦ Disimpan lokal â€” menunggu koneksi internet.";q.textContent="Tersimpan lokal sementara."}else{const d=await fetch(A+"?action=saveData&"+new URLSearchParams(a)).then(a=>a.text());q.textContent=d;r.style.display="none"}};p.onclick=()=>{if(confirm("Kosongkan semua kolom?"))[j,k,l,m,n].forEach(a=>a.value="")};u.onclick=()=>{const a=encodeURIComponent(t.textContent),b=C(l.value);window.open("https://wa.me/"+b+"?text="+a,"_blank")};v.onclick=()=>{navigator.clipboard.writeText(t.textContent);alert("Disalin ke clipboard")};x.onclick=async()=>{A1.textContent="Mencari...";const a=w.value.trim(),b=await fetch(A+"?action=searchStruk&q="+encodeURIComponent(a)).then(a=>a.json());z.innerHTML="";A1.textContent=b.length+" hasil ditemukan";b.forEach(c=>{const d=document.createElement("div");d.className="result-card";const e=D({noKwitansi:c.No_Struk,noUrut:c.No,nama:c.Nama,alamat:c.Alamat,nowa:c.No_WA,catatan:c.Keterangan,total:c.Total});d.innerHTML=`<b>${c.Nama}</b><br>No: ${c.No} | ${c.No_Struk}<br>Total: Rp ${B(c.Total)}<br><div class='actions'><button onclick="window.open('https://wa.me/${C(c.No_WA)}?text='+encodeURIComponent('${e}'),'_blank')">Bagikan WA</button><button class='danger' onclick="if(confirm('Hapus struk ini?'))fetch('${A}?action=deleteRow&no=${c.No}').then(r=>r.text()).then(alert)">Hapus</button><button onclick="navigator.clipboard.writeText(\`${e}\`)">Copy</button></div>`;z.appendChild(d)});};y.onclick=()=>{window.open(A+"?action=exportCSV&sheet=Struk","_blank")};window.addEventListener("online",F)})();
</script></body></html>